/**
 * t4utils - This is a utility class that can be used in conjuntion with content types in the Terminal 4 CMS.
 * @version v1.0.5
 * @link git+https://github.com/FPBSchoolOfNursing/T4Utils.git
 * @author Ben Margevicius
 * Copyright 2016. MIT licensed.
 * Built: Wed May 18 2016 12:15:21 GMT-0400 (Eastern Daylight Time).
 */
(function(t){"use strict";var e=0,n=Array.prototype.slice,i=[],r=function(t,e){return t.concat(e)},o=function(t,e,n){var i=t[e];return i||(i=t[e]={}),n&&!i[n]&&(i[n]=[]),n?i[n]:i},a=function(t,e,n){return o(i,e,n).map(s.bind(null,t)).reduce(r,o(t,e,n)).concat(o(t,e,"__global__"))},s=function(t,e){return o(t,e.id,e.fullname)},l=function(e,n){var i=e[n];if(i===t&&$.strict)throw new Error("Bottle was unable to resolve a service.  `"+n+"` is undefined.");return i},c=function(t){return t.split(".").reduce(l,this)},u=function(t,e,n,i){"function"==typeof n&&(i=n,n="__global__"),o(t,e,n).push(i)},g=function(t,e){var n=t.split(".");return t=n.pop(),f.call(n.reduce(E,this.container),t,e),this},f=function(t,e){Object.defineProperty(this,t,{configurable:!1,enumerable:!0,value:e,writable:!1})},h=[],d=function(t,e){return u(h,this.id,t,e),this},p=[],m=function(t){return u(p,this.id,t),this},v=function(t){return(t||[]).map(c,this.container)},T=function(t,e){return k.call(this,t,function(){this.$get=e})},U=[],b=function(t,e,n,i){var r=a(U,t,e),o={configurable:!0,enumerable:!0};return r.length?o.get=function(){var t=0,e=function(i){if(i)throw i;r[t]&&r[t++](n,e)};return e(),n}:(o.value=n,o.writable=!0),Object.defineProperty(i,e,o),i[e]},y=function(t,e){return u(U,this.id,t,e),this},w={},S=function(t){var e;return t?(e=w[t],e||(w[t]=e=new V,e.constant("BOTTLE_NAME",t)),e):new V},I=[],P=[],M=function(t,e){return e(t)},k=function(t,e){var n,i,r,a;return i=o(P,this.id),n=t.split("."),i[t]&&1===n.length&&!this.container[t+"Provider"]?console.error(t+" provider already instantiated."):(i[t]=!0,r=n.shift(),a=n.length?C:j,a.call(this,r,e,t,n))},j=function(e,n){var i,r,o,s;return s=this.id,o=this.container,i=e+"Provider",r=Object.create(null),r[i]={configurable:!0,enumerable:!0,get:function(){var t=new n;return delete o[i],o[i]=t,t}},r[e]={configurable:!0,enumerable:!0,get:function(){var n,r=o[i];return r&&(n=a(h,s,e).reduce(M,r.$get(o)),delete o[i],delete o[e]),n===t?n:b(s,e,n,o)}},Object.defineProperties(o,r),this},C=function(t,e,n,r){var a,s,l,c;return c=this.id,s=o(I,c),a=s[t],a||(this.container[t]=(a=s[t]=V.pop()).container),l=r.join("."),a.provider(l,e),u(i,a.id,l,{fullname:n,id:c}),this},L=function(e){var n=e.$value===t?e:e.$value;return this[e.$type||"service"].apply(this,[e.$name,n].concat(e.$inject||[]))},B=function(t){return o(p,this.id,"__global__").forEach(function(e){e(t)}),this},D=function(t,e){var i=arguments.length>2?n.call(arguments,2):null,r=this;return T.call(this,t,function(){return i&&(i=i.map(c,r.container),i.unshift(e),e=e.bind.apply(e,i)),new e})},_=function(t,e){var n;return n=t.split("."),t=n.pop(),x.call(n.reduce(E,this.container),t,e),this},E=function(t,e){var n=t[e];return n||(n={},x.call(t,e,n)),n},x=function(t,e){Object.defineProperty(this,t,{configurable:!0,enumerable:!0,value:e,writable:!0})},V=function O(t){return this instanceof O?(this.id=e++,void(this.container={$register:L.bind(this)})):O.pop(t)};V.prototype={constant:g,decorator:d,defer:m,digest:v,factory:T,middleware:y,provider:k,register:L,resolve:B,service:D,value:_},V.pop=S;var $=V.config={strict:!1},H={"function":!0,object:!0};!function(t){var e=H[typeof exports]&&exports&&!exports.nodeType&&exports,n=H[typeof module]&&module&&!module.nodeType&&module,i=n&&n.exports===e&&e,r=H[typeof global]&&global;!r||r.global!==r&&r.window!==r||(t=r),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.Bottle=V,define(function(){return V})):e&&n?i?(n.exports=V).Bottle=V:e.Bottle=V:t.Bottle=V}(H[typeof window]&&window||this)}).call(this),importPackage(java.lang),importClass(com.terminalfour.publish.PathBuilder),importPackage(com.terminalfour.media),importPackage(com.terminalfour.media.utils),importClass(com.terminalfour.sitemanager.cache.utils.CSHelper),importClass(com.terminalfour.sitemanager.cache.CachedContent),importPackage(com.terminalfour.sitemanager),importPackage(com.terminalfour.content);var bottle=function(t){var e=new Bottle;return e.service("oCM",function(){return ContentManager.getManager()}),e.service("oCH",function(){return new ContentHierarchy}),e.service("oConn",function(){return dbStatement}),e.service("oMM",function(){return MediaManager.getManager()}),e.service("oMU",function(){return MediaUtils}),e}(),T4Utils=function(t){return t.version="v1.0.2_2016.14.04",t.console=function(t,e){"string"==typeof e&&document.write("<script>console."+t+"('"+e+"');</script>\n")},t.write=function(t){document.write("<p>"+t+"</p>\n")},t.toString=function(t){return new java.lang.String(t)},t}(T4Utils||{});T4Utils.Bottle=bottle,String.prototype.toJavaString=function(){return new java.lang.String(this)},T4Utils.console=T4Utils.console||{},T4Utils.console.log=function(t){"string"==typeof t&&document.write("<script>console.log('"+t+"');</script>\n")},T4Utils.console.warn=function(t){"string"==typeof t&&document.write("<script>console.warn('"+t+"');</script>\n")},T4Utils.console.error=function(t){"string"==typeof t&&document.write("<script>console.error('"+t+"');</script>\n")},T4Utils.siteManager=T4Utils.siteManager||{},T4Utils.siteManager.version=com.terminalfour.sitemanager.SiteManagerVersion.version,T4Utils.siteManager.buildDetails=com.terminalfour.sitemanager.SiteManagerVersion.buildDetails,T4Utils.siteManager.javaVersion=java.lang.System.getProperty("java.version"),T4Utils.brokerUtils=T4Utils.brokerUtils||{},T4Utils.brokerUtils.processT4Tag=function(t){var e="undefined"!=typeof content?content:null;return com.terminalfour.publish.utils.BrokerUtils.processT4Tags(dbStatement,publishCache,section,e,language,isPreview,t)},T4Utils.elementInfo=T4Utils.elementInfo||{},T4Utils.elementInfo.getElements=function(){var t="undefined"!=typeof content?content:null;if(null!==t)return t.getElements();throw"Error: content does not have any elements"},T4Utils.elementInfo.getElementValue=function(t){var e="undefined"!=typeof content?content:null;if(null===e)throw"Error: content does not have any elements";var n=e.get(t);return"function"==typeof n.publish?n.publish():void 0},T4Utils.elementInfo.getElementName=function(t){var e="undefined"!=typeof content?content:null;if(null===e)throw"Error: content does not have any elements";var n=e.get(t);return"function"==typeof n.getName?e.get(t).getName():void 0},T4Utils.elementInfo.getElementID=function(t){var e="undefined"!=typeof content?content:null;if(null===e)throw"Error: content does not have any elements";var n=e.get(t);return"function"==typeof n.getID?n.getID():void 0},T4Utils.getSectionInfo=T4Utils.getSectionInfo||{},T4Utils.getSectionInfo.getPublishLink=function(){return this.publishLink},T4Utils.getSectionInfo.setPublishLink=function(t){this.publishLink=PathBuilder.getLink(dbStatement,t,publishCache,language,isPreview)},T4Utils.getSectionInfo.sectionTitle=function(t){return this.setPublishLink(t),this.publishLink.getText()},T4Utils.getSectionInfo.sectionLink=function(t){return this.setPublishLink(t),this.publishLink.getLink()},T4Utils.getSectionInfo.anchorLink=function(t){this.setPublishLink(t);var e=this.publishLink.getLink(),n=this.publishLink.getText(),i='<a href="'+e+'">'+n+"</a>";return i},T4Utils.getSectionInfo.getDirectory=function(t){return PathBuilder.getDirectory(t,publishCache,language).toString()},T4Utils.getSectionInfo.getChildren=function(t,e){return void 0===e&&(e=!1),t.getChildren(publishCache.channel,language,e)},T4Utils.getSectionInfo.getRootPath=function(t){return this.getPathUntilLevel(0,t)},T4Utils.getSectionInfo.getPathUntilLevel=function(t,e,n){n=n||[],n.push(e);var i=e.getLevel(publishCache.channel);if(i>t){var r=e.getParent();return this.getPathUntilLevel(t,r,n)}return n},T4Utils.getSectionInfo.getPathBySteps=function(t,e,n){if(n=n||[],n.push(e),n.length<t){var i=e.getParent();return null===i?n:this.getPathBySteps(t,i,n)}return n},T4Utils.getSectionInfo.getLevel=function(t){return t.getLevel(publishCache.channel)},T4Utils.media=T4Utils.media||{},T4Utils.media.getImageVariantsIds=function(t,e,n){void 0===e&&(e=MediaManager.getManager()),void 0===n&&(n=dbStatement);var i=content.get(t).getID(),r=e.getMediaVariants(n.getConnection(),i,language);return r},T4Utils.media.getImageDimensions=function(t,e){var n={width:0,height:0};return void 0===e&&(e=MediaUtils),n.width=e.getImageDimensions(t)[0],n.height=e.getImageDimensions(t)[1],n},T4Utils.media.getMediaObject=function(t){try{var e=T4Utils.Bottle.container.oMM,n=T4Utils.Bottle.container.oConn;return e.get(n.getConnection(),t,language)}catch(i){document.write(i.message)}},T4Utils.media.getImageTag=function(t,e,n,i){var r="";try{var o="<t4 />";T4Utils.write("Processing t4Tag: "+o),T4Utils.write("t4src is type: "+typeof o),T4Utils.write("t4src.length: "+o.length),T4Utils.write("t4 version: "+T4Utils.siteManager.version),T4Utils.write("t4 buildDetails: "+T4Utils.siteManager.buildDetails),T4Utils.write("t4 javaVersion: "+T4Utils.siteManager.javaVersion)}catch(a){document.write("error processing utils.media.getImageTag()"),document.write(a.message)}return r},T4Utils.security=T4Utils.security||{},T4Utils.security.toSHA256=function(t){importPackage(java.security);var e;try{var n=MessageDigest.getInstance("SHA-256"),i=new java.lang.String(t).getBytes("UTF-8");n.update(i);for(var r=n.digest(),o=new java.lang.StringBuffer,a=0;a<r.length;a++)o.append(java.lang.Integer.toString((255&r[a])+256,16).substring(1));e=o.toString()}catch(s){document.write(s)}return e},T4Utils.security.toHash=function(t,e){importPackage(java.security),importClass(javax.xml.bind.DatatypeConverter);try{var n=DatatypeConverter.printHexBinary(MessageDigest.getInstance(t).digest(new java.lang.String(e).getBytes("UTF-8")));return n}catch(i){document.write(i.message)}};